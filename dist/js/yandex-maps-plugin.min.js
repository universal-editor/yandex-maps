!function(){"use strict";angular.module("universalEditor.YandexMaps",["universalEditor.YandexMaps.templates","yaMap"]).config(function(){})}(),function(){"use strict";function e(e,a,l){var i,t=this;i=e.parentField?e.parentFieldIndex?e.parentField+"_"+e.parentFieldIndex+"_"+e.fieldName:e.parentField+"_"+e.fieldName:e.fieldName,t.fieldName=e.field.name,t.fieldValue="",t.readonly=e.field.readonly||!1,e.$parent.vm.error=[],t.parentFieldIndex=e.parentFieldIndex||!1,t.map=void 0,t.mapParam={height:e.field.mapHeight||"400",width:e.field.mapWidth||"400",center:e.field.mapCenter||[37.620393,55.765575],zoom:e.field.mapZoom||5},e.field.hasOwnProperty("multiple")&&e.field.multiple===!0?(t.multiple=!0,t.fieldValue=[],(e.field.multiname||angular.isString(e.field.multiname))&&(t.multiname=""+e.field.multiname||"value")):(t.multiple=!1,t.fieldValue=""),t.parentFieldIndex&&(t.multiple?(t.fieldValue=[],angular.forEach(l.getFieldValue(e.parentField,e.parentFieldIndex,e.field.name),function(e){t.multiname?t.fieldValue.push(e[t.multiname]):t.fieldValue.push(e)})):t.fieldValue=l.getFieldValue(e.parentField,e.parentFieldIndex,e.field.name)||t.fieldValue),a.addFieldController(this),this.getFieldValue=function(){var a,l,i={};return t.multiple?t.fieldValue.length>0?(a=[],angular.forEach(t.fieldValue,function(e){a.push(e.join(","))})):a="":a=t.fieldValue?t.fieldValue.join(","):"",t.multiple&&t.multiname?(l=[],angular.forEach(a,function(e){var a={};a[t.multiname]=e,l.push(a)})):l=a,e.parentField?t.parentFieldIndex?(i[e.parentField]=[],i[e.parentField][t.parentFieldIndex]={},i[e.parentField][t.parentFieldIndex][t.fieldName]=l):(i[e.parentField]={},i[e.parentField][t.fieldName]=l):i[t.fieldName]=l,i},this.getInitialValue=function(){var a={};return e.parentField?t.multiple?(a[e.parentField]={},a[e.parentField][t.fieldName]=[]):(a[e.parentField]={},a[e.parentField][t.fieldName]=""):t.multiple?a[t.fieldName]=[]:a[t.fieldName]="",a},t.addItem=function(){},t.removeItem=function(e){e="undefined"!=typeof e?e:-1,e>=0?angular.forEach(t.fieldValue,function(a,l){l==e&&t.fieldValue.splice(e,1)}):t.fieldValue=""},t.afterInit=function(e){t.map=e},t.mapDoubleClick=function(e){var a=e.get("coords");t.multiple?t.fieldValue.push(a):t.fieldValue||(t.fieldValue=a)},e.$on("editor:entity_loaded",function(a,l){return"new"===l.editorEntityType||null===l[e.field.name]?void(e.field.defaultValue?t.fieldValue=t.multiple?[e.field.defaultValue.split(",")]:e.field.defaultValue.split(","):t.fieldValue=t.multiple?[]:""):(e.parentField?t.multiple?t.multiname?(t.fieldValue=[],angular.forEach(l[e.parentField][e.field.name],function(e){t.fieldValue.push(e[t.multiname].split(","))})):(t.fieldValue=[],angular.forEach(l[e.parentField][e.field.name],function(e){t.fieldValue.push(e.split(","))})):t.fieldValue=l[e.parentField][e.field.name]?l[e.parentField][e.field.name].split(","):"":t.multiple?t.multiname?(t.fieldValue=[],angular.forEach(l[e.field.name],function(e){t.fieldValue.push(e[t.multiname].split(","))})):(t.fieldValue=[],angular.forEach(l[e.field.name],function(e){t.fieldValue.push(e.split(","))})):t.fieldValue=l[e.field.name]?l[e.field.name].split(","):"",void e.$evalAsync(function(){t.multiple?t.fieldValue.length>0&&(t.mapParam.center=t.fieldValue[0]):t.fieldValue&&(t.mapParam.center=t.fieldValue)}))}),e.$on("editor:api_error_field_"+i,function(a,l){angular.isArray(l)?angular.forEach(l,function(a){e.$parent.vm.error.indexOf(a)<0&&e.$parent.vm.error.push(a)}):e.$parent.vm.error.indexOf(l)<0&&e.$parent.vm.error.push(l)}),e.$on("$destroy",function(){a.deleteFieldController(t),t.parentFieldIndex&&l.fieldDestroy(e.parentField,e.parentFieldIndex,e.field.name,t.fieldValue)}),e.$watch(function(){return t.fieldValue},function(){e.$parent.vm.error=[]},!0)}angular.module("universalEditor.YandexMaps").controller("EditorFieldYandexMapsController",e),e.$inject=["$scope","EditEntityStorage","ArrayFieldStorage"]}(),function(){"use strict";function e(e){function a(e,a,l,i){a.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/directives/editorFieldYandexMaps/editorFieldYandexMaps.html"),controller:"EditorFieldYandexMapsController",controllerAs:"vm",link:a}}angular.module("universalEditor.YandexMaps").directive("editorFieldYandexMaps",e),e.$inject=["$templateCache"]}(),function(e){try{e=angular.module("universalEditor.YandexMaps.templates")}catch(a){e=angular.module("universalEditor.YandexMaps.templates",[])}e.run(["$templateCache",function(e){e.put("module/directives/editorFieldYandexMaps/editorFieldYandexMaps.html",'\n<div>\n    <div class="field-map-wrapper col-lg-6 col-md-6 col-sm-7 col-xs-8">\n        <ya-map data-ya-center="{{vm.mapParam.center}}" data-ya-zoom="{{vm.mapParam.zoom}}" data-ya-after-init="vm.afterInit($target)" data-ya-event-dblclick="vm.mapDoubleClick($event)" data-ya-controls="zoomControl searchControl fullscreenControl" data-ya-behaviors="scrollZoom multiTouch drag" style="width: {{vm.mapParam.width}}px; height: {{vm.mapParam.height}}px; display: block;">\n            <ya-geo-object data-ng-if="!vm.multiple &amp;&amp; vm.fieldValue" data-ya-source="{geometry:{type : \'Point\', coordinates : vm.fieldValue}}"></ya-geo-object>\n            <ya-geo-object data-ng-if="vm.multiple" data-ng-repeat="mark in vm.fieldValue track by $index" data-ya-source="{geometry:{type : \'Point\', coordinates : mark}, properties : { iconContent : $index + 1 }}"></ya-geo-object>\n        </ya-map>\n        <div class="field-map-values">\n            <div data-ng-if="vm.multiple" data-ng-repeat="item in vm.fieldValue track by $index" class="item-map-wrapper">\n                <div data-ng-click="vm.removeItem($index)" data-ng-if="!vm.readonly &amp;&amp; vm.fieldValue.length" class="btn btn-primary btn-xs">{{\'BUTTON.DELETE_MARK\' | translate}} {{$index + 1}}</div>\n            </div>\n            <div data-ng-if="!vm.multiple" class="item-map-wrapper">\n                <div data-ng-click="vm.removeItem()" data-ng-if="!vm.readonly &amp;&amp; vm.fieldValue" class="btn btn-primary btn-xs">{{\'BUTTON.DELETE_MARK\' | translate}}</div>\n            </div>\n        </div>\n    </div>\n</div>')}])}();